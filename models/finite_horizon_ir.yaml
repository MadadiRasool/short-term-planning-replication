declarations:
  name: "finite_horizon_ir"
  variables:
    [
      yhat,
      pihat,
      i,
      Mohat,
      m,
      yhatbar,
      ibar,
      pihatbar,
      mbar,
      Mohatbar,
      v,
      vtilde,
      # ylag,
      xi,
      ystar,
      Mostar,
    ]
  parameters:
    [
      # piA,
      # yQ,
      rho,
      kappa,
      beta,
      sigma,
      alpha,
      phipi,
      phiy,
      b,
      sigxi,
      sigy,
      sigMo,
      rhoxi,
      rhoy,
      rhoMo,
      gamma,
      gammatilde,
      phipiLR,
      phiyLR,
    ]
  observables: [ygr, infl, int]
  # observables: [yhat, pihat, Mohat]
  shocks: [epsxi, epsy, epsMo]

equations:
  model:
    # Euler Equation
    - yhat - xi - yhatbar = rho*(yhat(+1) - xi(+1) - yhatbar(+1)) - (1/sigma)*(i - ibar - rho*(pihat (+1) - pihatbar(+1)))

    # Phillips Curve
    - pihat - pihatbar =beta*rho*(pihat(+1) - pihatbar(+1)) + kappa*(yhat - ystar - yhatbar)

    # demand for money
    - m = (sigma/b) * yhat - (1/b) * i

    # money growth rate
    - Mohat = m - m(-1) + pihat

    # Monetary Policy
    - Mohat - Mohatbar = Mostar + phipi * (pihat - pihatbar) + phiy * (yhat - yhatbar)

    # Value functions
    - v = (1.0-gamma) * v(-1) + gamma * (yhat(-1) - xi(-1) + (1/sigma) * pihat(-1))
    - vtilde = (1- gammatilde) * vtilde(-1) + gammatilde * pihat(-1) / (1 - alpha)

    # Latent States
    - yhatbar = rho * yhatbar - (1/sigma) * (ibar - rho*pihatbar) + (1-rho) * v
    - pihatbar = beta*rho*pihatbar + kappa*yhatbar + (1-alpha)*beta*(1-rho)*vtilde

    - mbar = (sigma/b) * yhatbar - (1/b) * ibar
    - Mohatbar = mbar + pihatbar
    - Mohatbar = phipiLR * pihatbar + phiyLR*yhatbar
    # - ylag = yhat(-1)
    - xi = rhoxi * xi(-1) + epsxi
    - Mostar = rhoMo * Mostar(-1) + epsMo
    - ystar = rhoy * ystar(-1) + epsy

  observables:
    ygr: yhat
    infl: pihat
    int: Mohat
    # ygr: yQ + (y/ylag - 1) * 100
    # infl: piA + 4.0 * ppi
    # int: piA + 4.0 * Mo
    

calibration:
  parameters:
    sigma: 1.52
    b: 2.39
    # piA: 2
    # yQ: 0.5
    beta: 0.96
    kappa: 0.124
    alpha: 0.19
    rho: 1.0
    phipi: -1.24
    phiy: -2.23
    gamma: 0.1
    gammatilde: 0.1
    sigxi: 0.01
    sigMo: 0.01
    sigy: 0.01
    rhoxi: 0.8
    rhoy: 1.8
    rhoMo: 0.78
    phipiLR: -1.24
    phiyLR: -2.23

  covariances:
    epsxi: sigxi^2
    epsy: sigy^2
    epsMo: sigMo^2

estimation:
  data:
    file: "data/longsample_ir.txt"
    start: 1368Q1

  prior:
    alpha: [beta, 0.2, 0.02]
    sigma: [gamma, 1.5, 0.05]
    # piA: [normal, 4, 1]
    # yQ: [normal, 0.5, 0.1]
    rho: [uniform, 0, 1]
    beta: [beta, 0.96, 0.05]
    b: [gamma, 1.4, 0.05]
    gamma: [uniform, 0, 1]
    gammatilde: [uniform, 0, 1]
    kappa: [gamma, 0.12, 0.07]
    phipi: [normal, -1.24, 0.1]
    phiy: [normal, -2.23, 0.1]
    sigxi: [inv_gamma, 0.01, inf]
    sigMo: [inv_gamma, 0.01, inf]
    sigy: [inv_gamma, 0.01, inf]
    rhoxi: [beta, 0.8, 0.05]
    rhoy: [normal, 0.8, 0.05]
    rhoMo: [beta, 0.78, 0.05]
    phipiLR: [normal, -1.24, 0.1]
    phiyLR: [normal, -2.23, 0.1]
